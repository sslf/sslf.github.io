---
layout: post
category: 工具
#permalink: /mysql/reade-writ.html
---
mysql版本为：5.6
要读写分离，就要配置mysql的同步。
mysql的同步又分为：异步同步（默认），半同步同步。

### 同步原理
[mysql主从复制-介绍](https://blog.csdn.net/jesseyoung/article/details/41942467)

### 同步配置步骤
```shell
1.开启master的log-bin，并配置server-id，设置要同步的数据库
[mysqld]
log-bin=mysql-master-bin
server-id=1
# 设置要同步的数据库
binlog-do-db=test
# 设置不同的数据库
binlog-ignore-db=information_schema
binlog-ignore-db=performance_schema
binlog-ignore-db=mysql


2.在master上创建一个可以用来同步的账户，并赋上相应的权限
grant REPLICATION SLAVE on *.* to 'repl'@'%' identifiled by '密码';

3.(看情况可选操作)停止master新提交数据
FLUSH TABLES WITH READ LOCK；
UNLOCK TABLES;

4.查看master状态
SHOW MASTER STATUS;
#在主库上查看已连接的slave主机
show slave hosts;
#查看所有binlog日志
show binary logs;
#查看所有binlog 事件
show binlog events in 'mysql-bin.000003';

5.配置slave节点
[mysqld]
log-bin=mysql-slave-bin
server-id=2
# 设置要同步的数据库
binlog-do-db=test
# 设置不同的数据库
binlog-ignore-db=information_schema
binlog-ignore-db=performance_schema
binlog-ignore-db=mysql

6.在slave上连接master
change master to master_host='192.168.1.11',master_user='repl',master_password='654321',master_log_file='mysql-master-bin.000003',master_log_pos=397；
7.在salve启动slave功能
start slave;
# 停止
stop slave;

8.查看是否启动成功
show slave status \G;

以下两个参数为Yes则为启动成功
Slave_IO_Running: Yes
Slave_SQL_Running: Yes

```
以上是使用了默认（statement）的bin-log记录模式以及异步复制。

```shell
# 修改bin-log记录模式
binlog_format=mixed
# 半同步复制
rpl_semi_sync_master_enabled=ON

```
### 读写分离步骤
使用的时360的Atlas
[Atlas安装官方文档](https://github.com/Qihoo360/Atlas/wiki/Atlas%E7%9A%84%E5%AE%89%E8%A3%85)
